self.handler=async function(e,t){let a="";e.qoper8&&e.qoper8.token&&(a=e.qoper8.token);if(self.idb&&self.idb.db){let i=e.storeName;self.idb.storeName=e.storeName;let r=self.idb.stores[i];if(!r.isValidToken(a))return t({error:"Invalid access attempt"});let s={};if(e.clear)await r.iterate(async function(e,t){await r.clearByKey(e,a)});else{if(0===await r.count()&&r.isAuthenticated())await r.setSignature(a),r.setReady(a);else{if(r.isAuthenticated()){let e=await r.get(["signature"]);if(!e)return t({error:"The requested store is not encrypted, but you have supplied authentication credentials"});if(!r.isValidSignature(e.value))return t({error:"Invalid authentication credentials for specified store"});r.setReady(a)}delete(s=await r.retrieve(a)).signature}}t({obj:s})}else t({error:"Database not instantiated"})};