self.handler=async function(e,t){let a="";e.qoper8&&e.qoper8.token&&(a=e.qoper8.token);let i=this;if(i.idb&&i.idb.db){let r=e.storeName;i.idb.storeName=e.storeName;let n=i.idb.stores[r];if(!n.isValidToken(a))return t({error:"Invalid access attempt"});let s={};if(e.clear)await n.iterate(async function(e,t){await n.clearByKey(e,a)});else{if(0===await n.count()&&n.isAuthenticated())await n.setSignature(a),n.setReady(a);else{if(n.isAuthenticated()){let e=await n.get(["signature"]);if(!e)return t({error:"The requested store is not encrypted, but you have supplied authentication credentials"});if(!n.isValidSignature(e.value))return t({error:"Invalid authentication credentials for specified store"});n.setReady(a)}delete(s=await n.retrieve(a)).signature}}t({obj:s})}else t({error:"Database not instantiated"})};